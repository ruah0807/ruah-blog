const n=`---
title: Airflow를 사용한 API 데이터 수집 및 처리
---

## Airflow를 사용한 API 데이터 수집 및 처리

![](https://velog.velcdn.com/images/looa0807/post/8b7a09ec-6d36-43c6-ac02-8d697430933b/image.png)

### 1. API 호출 실패 시:

**a. 로그를 기록:**

- 모든 API 호출 실패를 상세히 기록합니다. 이는 문제가 발생했을 때 원인을 추적하고, 필요한 조치를 취하기 위해 중요합니다.

**b. 재시도 매커니즘:**

- 일시적인 오류에 대비해 몇 번의 재시도를 수행합니다. 네트워크 문제나 일시적인 서버 오류로 인해 요청이 실패할 수 있기 때문에, 이런 경우를 대비해 재시도를 수행함으로써 성공률을 높입니다.

**c. 오류 분류:**

- 오류의 유형을 네트워크 오류, 서버 오류 등으로 구분하여 대응합니다. 이렇게 오류를 분류하면, 적절한 대응 전략을 수립하는 데 도움이 됩니다.

**d. 알림 시스템:**

- 지속적인 실패가 발생할 경우, 관리자에게 알림을 전송합니다. 이는 심각한 문제가 발생했을 때 빠르게 대응할 수 있도록 도와줍니다.

**e. 대체 데이터 사용:**

- 실패가 지속되는 경우, 이전에 성공적으로 수집한 데이터를 사용하거나 추정치를 활용합니다. 이렇게 하면, 데이터 부족으로 인한 분석 결과의 왜곡을 최소화할 수 있습니다.

### 2. 비정상 데이터 처리:

**a. 데이터 유효성 검사:**

- 잘못된 데이터가 파이프라인에 들어오지 않도록 하게 하기위해, 데이터의 유효성을 확인(모든 필드에 대해 데이터 타입과 값의 범위를 검사)

**b. 기본값 설정:**

- 데이터 값이 NaN 또는 Null인 경우, 미리 정의된 기본값을 적용하므로서, 비정상적인 데이터로 인해 분석이 왜곡되는 것을 방지합니다.

**c. 이상치 처리:**

- 통계적 방법이나 비즈니스 규칙을 적용해 이상치를 식별하고 처리합니다. 예를 들어, 비정상적으로 높은 값이 나올 경우 최근 평균값으로 대체할 수 있습니다.

**d. 로그 기록:**

- 데이터 처리 과정에서 무슨 일이 일어났는지를 추적하기 위해 모든 데이터 변환 과정을 로그로 남깁니다.

**e. 데이터 품질 보고:**

- 데이터 품질을 지속적으로 관리하고, 개선하기위해, 주기적으로 데이터 품질 리포트를 생성하여 관리자가 확인할 수 있도록 합니다.

---

### Metabase란?

> - Metabase는 오픈 소스 데이터 분석 및 시각화 도구로, 사용자가 SQL 쿼리를 작성하지 않고도 데이터베이스에 저장된 데이터를 쉽게 조회하고 시각화할 수 있도록 도와줍니다.
> - Metabase는 비즈니스 인텔리전스(BI) 도구로 분류되며, 데이터 분석가뿐만 아니라 비기술자들도 쉽게 데이터를 이해하고 활용할 수 있게 해줍니다.

#### 1. 사용자 친화적 인터페이스

- Metabase는 직관적인 인터페이스를 제공하여, SQL 쿼리를 몰라도 누구나 데이터베이스에서 데이터를 추출하고 분석할 수 있습니다. 사용자는 질문(Questions)을 만들고, 이를 통해 데이터를 조회하고 대시보드에 시각화할 수 있습니다.

#### 2. 대시보드 생성:

- Metabase를 사용하면, 데이터를 바탕으로 대시보드를 쉽게 만들 수 있습니다. 여러 질문(Questions)의 결과를 한 곳에 모아 시각화하여, 비즈니스에 중요한 지표들을 한눈에 파악할 수 있습니다.

#### 3. 데이터베이스와의 통합:

- Metabase는 MySQL, PostgreSQL, MongoDB, SQLite, Amazon Redshift 등 다양한 데이터베이스와의 통합을 지원합니다. 또한 Google Analytics, Google BigQuery 같은 외부 서비스와도 연동할 수 있습니다.

#### 4. 자동화된 보고서 및 알림:

- Metabase는 특정 시간 간격으로 자동 보고서를 생성하거나, 특정 조건에 따라 알림을 설정할 수 있습니다. 예를 들어, 매일 아침 전날의 판매 데이터를 요약한 보고서를 이메일로 받을 수 있습니다.

#### 5. 오픈 소스와 클라우드 옵션:

- Metabase는 오픈 소스 소프트웨어로, 사용자가 직접 서버에 설치하여 사용할 수 있습니다. 또한, Metabase는 클라우드 버전도 제공하여, 설정 및 관리를 쉽게 할 수 있습니다.

——————————————————————

### Metabase를 통한 시계열 데이터 대시보드 구현 및 성능 개선 방안

![](https://velog.velcdn.com/images/looa0807/post/167663e4-f589-4609-a487-64611ef9d8a8/image.png)

#### 1. 데이터정리

시간별, 일별 데이터 집계:

- 시계열 데이터를 처리할 때, 시간 단위나 일 단위로 데이터를 집계하여 데이터를 간결하게 만듭니다. 예를 들어, 매 시간마다의 총 매출액을 집계하거나, 일별 사용자 수를 계산할 수 있습니다.

* 데이터를 시간 단위, 일 단위로 미리 집계해 두면, 대시보드에서 조회해야 하는 데이터 양이 줄어들어 성능이 향상됩니다. 이렇게 하면, 대량의 데이터를 요약된 형태로 보관하여 쿼리 성능을 최적화할 수 있습니다.

중요 지표의 사전 계산 및 저장:

- 자주 사용하는 중요 지표(예: 평균 판매량, 최대 트래픽 시간 등)를 미리 계산하여 저장해 둠으로써, 대시보드가 실시간으로 계산할 필요 없이 빠르게 데이터를 표시할 수 있습니다.

#### 2. 효율적인 데이터 저장 구조

시간, 날짜, 상품 카테고리별 데이터 파티셔닝:

- 데이터를 시간, 날짜, 또는 상품 카테고리와 같은 기준으로 파티셔닝(분할)하여 저장하면, 특정 범위의 데이터만 빠르게 조회할 수 있습니다. 이렇게 하면 대량의 데이터를 한꺼번에 읽어들일 필요 없이 필요한 데이터만 읽어들여 성능을 향상시킬 수 있습니다.
- 예를들어, 특정 날짜나 상품 카테고리에 해당하는 데이터만 조회하게 되면 불필요한 데이터 스캔을 줄여 성능이 향상됩니다. 이는 Athena 쿼리 성능을 극대화하는 데 도움이 됩니다.

컬럼 기반 저장 형식(Parquet 등) 사용:

- **Parquet**과 같은 컬럼 기반 저장 형식을 사용하면, 데이터 분석 작업에서 필요한 컬럼만 읽어들일 수 있어 성능이 크게 향상됩니다. 이는 대량의 데이터를 효율적으로 저장하고 처리하는 데 매우 유용합니다.

#### 3. 쿼리 최적화

필요 데이터만을 선별적으로 스캔하는 최적화된 쿼리 작성:

- 쿼리를 작성할 때, 필요한 데이터만 스캔하도록 쿼리를 최적화합니다. 예를 들어, 특정 시간 범위나 특정 조건에 맞는 데이터만을 조회하는 방식으로 쿼리를 작성하여 성능을 향상시킬 수 있습니다.

* 이렇게하면, 불필요한 데이터 접근을 최소화하여 쿼리 성능을 향상시킬 수 있습니다. 특히, 대량의 데이터를 다룰 때 이 전략은 매우 효과적입니다.

복잡한 연산을 사전 처리 및 결과 저장:

- 복잡한 연산(예: 대규모 집계 연산)을 대시보드 요청 시점에 처리하는 대신, 미리 계산하고 그 결과를 저장해 둠으로써 실시간 응답 속도를 높입니다.

#### 4. 데이터 수명 주기 관리

오래된 상세 데이터의 아카이빙 또는 삭제:

- 일정 기간이 지난 오래된 데이터를 아카이빙하거나 삭제하여, 운영 데이터베이스의 부담을 줄이고 성능을 유지합니다.
- 예를 들어, 지난 1년간의 데이터만 유지하고, 그 이전의 데이터는 저비용 스토리지로 이동시킬 수 있습니다.

데이터 보존 기간에 따른 저장소 선택(고성능 DB vs S3/Athena):

- 데이터 보존 기간에 따라 저장소를 다르게 설정합니다. 예를 들어, 최근 데이터는 고성능 관계형 데이터베이스에 저장하고, 오래된 데이터는 S3나 Athena 같은 저비용 스토리지에 저장하여 비용을 절감합니다.

#### 5. 하이브리드 스토리지 전략

최신 데이터용 고성능 관계형 데이터베이스 사용:

- 최신 데이터는 실시간으로 빠르게 조회해야 하므로, 고성능 관계형 데이터베이스에 저장하여 높은 성능을 유지합니다.
  장기 데이터용 비용 효율적인 데이터 레이크 활용:
- 장기적으로 보관해야 하는 대량의 데이터는 비용 효율적인 데이터 레이크(S3 등)에 저장하여, 필요할 때만 분석에 사용하고, 비용을 절감합니다.

이 전략들은 AWS Athena를 통한 데이터 조회 성능을 높이기 위해 설계되었습니다. 이렇게 하면, Metabase에서 시계열 데이터 대시보드를 사용할 때 성능 저하 없이 빠르고 효율적인 데이터 접근이 가능해집니다.
`;export{n as default};
