const n=`---
title: AWS RDS에서 AWS S3로의 CDC(변경 데이터 캡처) 구성 아키텍쳐
---

![](https://velog.velcdn.com/images/looa0807/post/562ddef2-ae77-4ca9-8f16-0a1b4b880466/image.png)

### 1. AWS RDS (Relational Database Service)

먼저, AWS RDS는 Amazon Web Services에서 제공하는 관리형 데이터베이스 서비스입니다.
이 예제에서는 세 개의 데이터베이스(nicon DB, payment DB, coupon DB)가 사용되며, 각각의 데이터베이스에는 다양한 테이블들이 포함되어 있습니다.
예를 들어, users 테이블에는 사용자 프로필 정보가, items 테이블에는 제품 관련 정보가 저장됩니다.
다른 테이블들에는 거래 정보(orders), 물류 데이터(deliverys), 쿠폰 및 프로모션 데이터(coupons) 등이 포함됩니다.
이 단계에서는 데이터를 안전하게 저장하고 관리합니다.

### 2. Apache Airflow

그다음, Apache Airflow는 워크플로우를 자동화하고 스케줄링 합니다.
Airflow는 CDC 작업을 트리거하기 위해 AWS DMS 작업을 설정하고, 정해진 시간에 이 작업을 실행하도록 스케줄링할 수 있습니다.
이 트리거는 하루 네 번(00:00, 06:00, 12:00, 18:00) 데이터베이스에서 변경된 데이터를 추적 후,
DMS에 “지금 RDS에서 변경된 데이터를 캡처하여 S3에 저장하세요”라는 명령을 주는 역할을 합니다.

### 3. AWS Database Migration Service (DMS)

airflow의 명령을 받은 DMS는 데이터베이스의 변경된 데이터를 캡처하여 Amazon S3에 저장합니다.
이는 데이터를 S3로 이동하기 전에 필요한 부분을 우선적으로 처리하여 효율성을 높입니다.
이 단계에서는 데이터베이스에서 수집된 데이터를 안전하게 다른 저장소로 이동시킵니다.
CDC 작업을 통해 주로 추적하는 것은 사용자 활동, 거래, 배송, 프로세스, 프로모션 및 재고와 관련된 데이터입니다.
이러한 데이터를 수집함으로써, 시스템은 실시간에 가까운 최신 정보를 데이터 파이프라인의 다음 단계로 전달할 수 있습니다.
이 데이터들은 이후 분석 및 보고에 사용되며, 이를 통해 고객 행동의 이해를 돕고, 판매 패턴을 파악하고, 배송의 효율성 개선 및 프로모션의 효과를 측정하는 등의 비즈니스 인사이트를 도출할 수 있습니다.

### 4. AWS S3 (Simple Storage Service)

AWS S3는 데이터를 파일 형태로 안전하게 저장할 수 있는 스토리지 서비스로서,

#### S3 Raw Data 저장:

처음에는 AWS DMS를 통해 RDS에서 수집된 변경된 데이터(CDC) 가 아직 가공되지 않은 상태로 S3의 Raw Data 영역에 저장됩니다.

#### AWS Glue

이 데이터는 AWS Glue를 통해 ETL(Extract, Transform, Load) 작업을 거칩니다. Glue는 데이터를 추출하고, 필요한 변환 작업을 수행한 후, 데이터를 분석에 적합한 형태로 변환합니다.
(또한 glue는 데이터 카탈로그를 관리하여, 데이터의 위치와 구조를 쉽게 찾을 수 있도록 도와줍니다.)

#### S3 Processed Data 저장:

그 변환된 데이터는 S3의 Processed Data 영역에 저장됩니다. 이 데이터는 이제 분석과 비즈니스 인사이트 도출에 바로 사용할 수 있는 상태입니다.

S3는 이 모든 데이터를 안전하게 저장하고, 필요할 때 언제든지 접근할 수 있도록 지원합니다.

### 5. AWS Athena

마지막으로, AWS Athena는 S3에 저장된 대규모의 데이터를 SQL 쿼리로 직접 조회하고 분석할 수 있는 서비스입니다.
데이터 분석가는 AWS Athena를 사용하여 S3의 데이터를 직접 쿼리하고 필요한 정보를 분석할 수 있습니다.
또한, athena는 사용한 쿼리 양과 데이터 양에 따라 비용이 부과되고, 데이터베이스나 데이터 웨어하우스를 직접 운영하지 않고도 필요한 분석을 수행할 수 있어,
관리 비용과 운영 부담이 줄어듭니다.
이 단계에서는 복잡한 인프라 설정 없이도 데이터를 쉽게 분석할 수 있습니다.

> **전체 프로세스 요약:**

1. Apache Airflow가 정해진 시간에 데이터베이스의 변경 사항을 캡처하는 작업을 트리거합니다.
2. AWS DMS가 RDS에서 변경된 데이터를 캡처하여 S3의 Raw Data 영역에 저장합니다.
3. AWS Glue가 Raw Data를 정제하여 Processed Data로 변환하고, 이를 다시 S3에 저장합니다.
4. 마지막으로, 데이터 분석가는 AWS Athena를 사용하여 S3에 저장된 데이터를 직접 쿼리하고 분석할 수 있습니다.

---

### CDC에서 주로 추적하는 데이터:

#### 1. 사용자 활동 데이터 (userLogs, itemLogs):

userLogs: 사용자의 행동이나 활동에 대한 데이터를 수집합니다. 예를 들어, 사용자가 로그인했거나, 특정 페이지를 방문했거나, 제품을 클릭했을 때의 기록을 저장합니다.
itemLogs: 특정 제품과 관련된 활동 데이터를 추적합니다. 예를 들어, 제품의 조회수, 장바구니에 추가된 횟수, 구매 여부 등의 데이터를 기록합니다.

#### 2. 거래 데이터 (orders):

orders 테이블에서는 사용자가 구매를 완료했을 때의 주문 정보를 수집합니다. 주문이 새로 생성되거나, 주문 상태가 변경될 때마다 그 변경사항을 추적합니다.

#### 3. 배송 데이터 (deliverys):

deliverys 테이블에서는 상품이 고객에게 배송되는 과정에서 발생하는 데이터를 추적합니다. 예를 들어, 배송이 시작되었거나, 배송 완료 상태로 업데이트된 정보를 기록합니다.

#### 4. 프로세스 데이터 (orderLogs, deliveryLogs):

orderLogs: 주문 처리 과정에서 발생하는 세부 정보를 기록합니다. 예를 들어, 주문이 처리되는 단계별 로그를 추적합니다.
deliveryLogs: 배송 과정에서 발생하는 세부 로그를 추적합니다. 예를 들어, 배송 경로의 변경이나, 배송 지연 정보 등을 기록합니다.

#### 5. 프로모션 및 재고 데이터 (coupons, products, productLogs):

coupons: 새로운 쿠폰이 발행되거나, 쿠폰이 사용된 정보를 추적합니다.
products: 제품의 기본 정보가 변경될 때 추적합니다. 예를 들어, 제품의 가격이 변경되거나, 재고가 업데이트될 때 해당 변경사항을 기록합니다.
productLogs: 재고 변동이나, 내부적인 카탈로그 업데이트와 같은 활동을 추적합니다.

---

### AWS Glue가 정제할 수 있는 예시 작업:

#### users 테이블 (사용자 프로필 데이터):

• 데이터 정규화: 예를 들어, 사용자 이름을 대문자 또는 소문자로 통일하거나, 잘못된 이메일 형식을 정정합니다.
• 중복 제거: 중복된 사용자 레코드를 제거하여, 하나의 사용자 프로필만 남기도록 합니다.

#### items 테이블 (제품 카탈로그 데이터):

• 가격 변동 내역 정리: 특정 기간 동안의 가격 변동 데이터를 집계하여, 현재 가격 외에도 평균 가격, 최대/최소 가격을 포함하는 요약 정보를 생성합니다.
• 재고 상태 업데이트: 재고가 0인 경우 해당 제품을 별도로 표시하거나, 특정 카테고리로 분류합니다.

#### 3. userLogs 및 itemLogs 테이블 (활동 로그 데이터):

• 로그 요약: 사용자 활동 로그를 요약하여, 특정 사용자나 제품에 대한 총 활동 횟수를 집계하거나, 주요 이벤트(예: 구매, 리뷰 작성 등)에 대한 통계를 생성합니다.
• 불필요한 로그 제거: 분석에 필요하지 않은 로그(예: 중복된 클릭 이벤트)를 필터링하여 제거합니다.

#### orders 테이블 (주문 데이터):

• 주문 상태 정리: 미완료된 주문이나 취소된 주문을 별도로 분류하여 저장하거나, 주문 상태별로 데이터를 그룹화합니다.
• 매출 집계: 특정 기간 동안의 매출 데이터를 집계하여, 일별, 주별, 월별 매출 합계를 생성합니다.

#### deliverys 테이블 (배송 데이터):

• 배송 시간 계산: 배송 시작 시간과 완료 시간 간의 차이를 계산하여, 평균 배송 시간을 산출합니다.
• 지연된 배송 필터링: 지연된 배송 데이터를 필터링하여, 평균 배송 시간을 초과한 건만 추출하고 분석할 수 있도록 합니다.

#### orderLogs 및 deliveryLogs 테이블 (프로세스 로그 데이터):

• 프로세스 효율성 분석: 주문 처리 또는 배송 과정에서 발생하는 문제점(예: 지연, 오류)을 집계하고, 평균 처리 시간을 계산하여 문제를 분석할 수 있는 데이터를 생성합니다.
• 이상치 탐지: 비정상적으로 긴 처리 시간을 가진 로그 항목을 탐지하여, 별도로 저장합니다.

#### coupons 테이블 (쿠폰 및 프로모션 데이터):

• 사용된 쿠폰 분석: 사용된 쿠폰의 종류별로 사용 빈도를 집계하고, 사용된 쿠폰의 총 할인 금액을 계산합니다.
• 만료된 쿠폰 필터링: 이미 만료된 쿠폰 데이터를 필터링하여, 분석에 방해가 되지 않도록 처리합니다.

#### products 테이블 (제품 기본 정보 데이터):

• 카테고리 정리: 제품 카테고리를 정규화하거나, 잘못된 카테고리 정보를 수정합니다.
• 사양 요약: 제품의 주요 사양(예: 크기, 색상)을 요약하여, 한 줄로 나타낼 수 있는 형태로 재구성합니다.

#### productLogs 테이블 (제품 관련 재고 로그 데이터):

• 재고 변동 분석: 제품별 재고 변동 내역을 집계하여, 재고 관리에 필요한 요약 데이터를 생성합니다.
• 재고 부족 경고: 재고가 일정 임계값 이하로 내려간 제품에 대해 경고 데이터를 생성하고, 이를 별도로 저장합니다.
`;export{n as default};
